<!DOCTYPE html>
<head>
    <style>
        table {
        border-collapse: collapse;
        }

        th, td {
        border: 1px solid black;
        }
    </style>
    <script src="report.js" type="text/javascript"></script>
    <script>
        window.onload = () => {
            var channelsTableElement = document.getElementById("channels");
            channels.forEach(channel => {
                var tableRowElement = document.createElement("tr");
                var channelNameTd = document.createElement("td");
                channelNameTd.innerText = channel.ChannelName;
                tableRowElement.appendChild(channelNameTd);

                var totalProgramsTd = document.createElement("td");
                tableRowElement.appendChild(totalProgramsTd);
                // totalProgramsTd.innerText = 
                // var channelIdTd = document.createElement("td");
                // channelIdTd.innerText = channel.ChannelName;
                // tableRowElement.appendChild(channelIdTd);

                var totalDurationTD = document.createElement("td");
                tableRowElement.appendChild(totalDurationTD);
                totalDurationTD.innerText = channel.Duration;

                let totalPrograms = 0;
                for (i=0; i<5; i++) {
                    var grabberTd = document.createElement("td");
                    tableRowElement.appendChild(grabberTd);

                    if (i < channel.GrabbersList.length) {
                        var grabber = channel.GrabbersList[i];
                        totalPrograms += grabber.ProgramsCount;
                        grabberTd.innerText = grabber.GrabberId + ": " + grabber.ProgramsCount
                        + ", " + grabber.Duration;
                    } else {
                        grabberTd.innerText = 0;
                    }
                }
                totalProgramsTd.innerText = totalPrograms;
                channelsTableElement.appendChild(tableRowElement);
            });
            // console.log(channels);

            var grabbers = {};
            channels.forEach(channel => {
                channel.GrabbersList.forEach(grabber => {
                    if (grabber.GrabberId in grabbers) {
                        var grabberData = grabbers[grabber.GrabberId];
                        grabberData.totalPrograms += grabber.ProgramsCount;
                        grabberData.usedInChannels += 1;
                        grabberData.totalDuration += grabber.DurationInMs;
                    } else {
                        grabberData = { totalPrograms: grabber.ProgramsCount, totalDuration: 0, usedInChannels: 1};
                        grabbers[grabber.GrabberId] = grabberData;
                    }
                });
            });

            var grabbersTableElement = document.getElementById("grabbers");

            for (const [grabberId, grabber] of Object.entries(grabbers)) {
            // grabbers.forEach(grabber => {
                var tableRowElement = document.createElement("tr");

                var grabberNameTdElement = document.createElement("td");
                grabberNameTdElement.innerText = grabberId;
                tableRowElement.appendChild(grabberNameTdElement);

                var usageTdElement = document.createElement("td");
                usageTdElement.innerText = grabber.usedInChannels;
                tableRowElement.appendChild(usageTdElement);

                var totalProgramsTdElement = document.createElement("td");
                totalProgramsTdElement.innerText = grabber.totalPrograms;
                tableRowElement.appendChild(totalProgramsTdElement);


                var totalDurationTdElement = document.createElement("td");
                totalDurationTdElement.innerText = new Date(grabber.totalDuration).toISOString().substr(11, 8);
                tableRowElement.appendChild(totalDurationTdElement);



                grabbersTableElement.appendChild(tableRowElement);
            }

        }
    </script>
</head>
<body>
    <table id="channels" cellspacing="0" cellpadding="5" style="padding: 5px">
        <tr>
            <th rowspan="2">Channel name</th>
            <!-- <th>Channel Id</th> -->
            <th rowspan="2">Total programs</th>
            <th rowspan="2">Overall grabbing duration</th>
            <th colspan="5">Grabbing rounds</th>
        </tr>
        <tr>
            <th>#1</th>
            <th>#2</th>
            <th>#3</th>
            <th>#4</th>
            <th>#5</th>
        </tr>
    </table>

    <hr />

    <table id="grabbers" cellspacing="0" cellpadding="5" style="border:1px solid #000; padding: 5px">
        <tr>
            <th>Grabber name</th>
            <th>Used in channels</th>
            <th>Total programs grabbed</th>
            <th>Total time in use</th>
        </tr>
    </table>
</body>
</html>